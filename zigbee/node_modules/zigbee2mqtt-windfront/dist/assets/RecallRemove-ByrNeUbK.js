import{ah as j,r as c,b as g,W as y,j as a,B as N,S as C}from"./index-B9KSRkAy.js";import{D as F}from"./DashboardFeatureWrapper-BV-EJkYu.js";import{b as v,F as E,g as T}from"./Feature-DRiBEd30.js";import{I as S}from"./InputField-D8fYIAZ2.js";import{S as I}from"./SelectField-CwoktH0d.js";function k(t){if(j(t)){const e=[];for(const i in t.endpoints){const s=t.endpoints[i];for(const r of s.scenes)e.push({...r})}return e}return t.scenes}const M=["schedule_","_mode","_options","_startup","_type","inching_","cyclic_"],R=["effect"],L=["state","color_temp","color","transition","brightness"],D=(t,e)=>{if(t){if(L.includes(t))return!0;for(const i of M)if(t.includes(i))return!1;if(R.includes(t))return!1}return!e||e===v.ALL||e===v.SET||e===v.STATE_SET};function A(t){const{name:e,access:i}=t;if(D(e,i)){if("features"in t&&t.features&&t.features.length>0){const s=[];for(const r of t.features){const n=A(r);n&&!s.some(l=>l.property===n.property)&&s.push(n)}return{...t,features:s}}return{...t}}}const P=c.memo(t=>{const{target:e,deviceState:i}=t,{t:s}=g("scene"),{sendMessage:r}=c.useContext(y),[n,l]=c.useState(0),[d,m]=c.useState(""),f=c.useMemo(()=>k(e),[e]),p=c.useMemo(()=>{const o=[];if(j(e))for(const h of e.definition?.exposes??[]){const x=A(h);x&&o.push(x)}return o},[e]),_=c.useCallback(async o=>{await r(`${e.friendly_name}/set`,o)},[r,e]),b=c.useCallback(async()=>{const o={ID:n,name:d||`Scene ${n}`};await r(`${e.friendly_name}/set`,{scene_store:o})},[r,e,n,d]),u=c.useMemo(()=>n>=0&&n<=255&&!f.find(o=>o.id===n),[n,f]);return a.jsxs(a.Fragment,{children:[a.jsx("h2",{className:"text-lg font-semibold",children:s("add_update_header")}),a.jsxs("div",{className:"mb-3",children:[a.jsx(S,{name:"scene_id",label:s("scene_id"),type:"number",value:n,onChange:o=>!!o.target.value&&l(o.target.valueAsNumber),min:0,max:255}),a.jsx(S,{name:"scene_name",label:s("scene_name"),type:"text",value:d,placeholder:`Scene ${n}`,onChange:o=>m(o.target.value)}),p.length>0&&a.jsx("div",{className:"card card-border bg-base-200 shadow my-2",children:a.jsx("div",{className:"card-body",children:p.map(o=>a.jsx(E,{feature:o,device:e,deviceState:i,onChange:_,featureWrapperClass:F,minimal:!0,parentFeatures:[]},T(o)))})})]}),a.jsx(N,{disabled:!u,onClick:b,className:"btn btn-primary",children:s("store")})]})}),$=c.memo(t=>{const{t:e}=g("scene"),{onSceneSelected:i,scenes:s=[],value:r}=t;return s.length>0?a.jsxs(I,{name:"scene_picker",label:e("scene_name"),value:r?.id??"",onChange:n=>!n.target.validationMessage&&!!n.target.value&&i(Number.parseInt(n.target.value,10)),children:[a.jsx("option",{value:"",disabled:!0,children:e("select_scene")}),s.map(n=>a.jsxs("option",{value:n.id,children:[n.id,": ",n.name]},n.id))]}):a.jsx(S,{name:"scene_picker",label:e("scene_id"),type:"number",value:r?.id??"",onChange:n=>!n.target.validationMessage&&!!n.target.value&&i(n.target.valueAsNumber),min:0,max:255})}),V=c.memo(t=>{const{target:e}=t,{sendMessage:i}=c.useContext(y),{t:s}=g(["scene","common"]),[r,n]=c.useState({id:0,name:"Scene 0"}),[l,d]=c.useState(!0),m=c.useMemo(()=>k(e),[e]),f=c.useCallback(u=>{d(!1);const o=m.find(h=>h.id===u);n(o!==void 0?o:{id:u,name:`Scene ${u}`})},[m]),p=c.useCallback(async()=>await i(`${e.friendly_name}/set`,{scene_recall:r.id}),[i,e.friendly_name,r.id]),_=c.useCallback(async()=>await i(`${e.friendly_name}/set`,{scene_remove:r.id}),[i,e.friendly_name,r.id]),b=c.useCallback(async()=>await i(`${e.friendly_name}/set`,{scene_remove_all:""}),[i,e.friendly_name]);return a.jsxs(a.Fragment,{children:[a.jsx("h2",{className:"text-lg font-semibold",children:s("manage_scenes_header")}),a.jsx("div",{className:"mb-3",children:a.jsx($,{onSceneSelected:f,value:l?void 0:r,scenes:m})}),a.jsxs("div",{className:"join join-horizontal",children:[a.jsx(N,{disabled:l,onClick:p,className:"btn btn-success join-item",children:s("recall")}),a.jsx(C,{disabled:l,onClick:_,className:"btn btn-error join-item",title:s("remove"),modalDescription:s("common:dialog_confirmation_prompt"),modalCancelLabel:s("common:cancel"),children:s("remove")}),a.jsx(C,{onClick:b,className:"btn btn-error btn-outline join-item",title:s("remove_all"),modalDescription:s("common:dialog_confirmation_prompt"),modalCancelLabel:s("common:cancel"),children:s("remove_all")})]})]})});export{P as A,V as R,A as g};
