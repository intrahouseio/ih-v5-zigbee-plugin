import{r as n,W as E,a as c,s as w,D as j,b as q,j as a,t as k,c as M,L as C}from"./index-B9KSRkAy.js";import{A as I,D as T}from"./Availability-9y0Errm-.js";import{D as A}from"./DeviceImage-XiUg0NFS.js";import{C as F}from"./CheckboxField-DnsgrtmM.js";import{T as H}from"./Table-D8Gdn1uG.js";import{L as P}from"./LastSeen-kmLjgf_4.js";import{L as O}from"./Lqi-BZ7lW9bx.js";import{M as V,V as B}from"./VendorLink-KoryP9lw.js";import{P as R}from"./PowerSource-DgbKMgpx.js";import"./envs-DFlyG_dH.js";import"./DeviceControlEditName-CW6kAJai.js";import"./InputField-D8fYIAZ2.js";import"./index-DajxErfA.js";import"./DebouncedInput-BbusN73N.js";import"./format-CsVfcRLB.js";import"./DisplayValue-DKwqD83w.js";import"./snakeCase-BsE9z82R.js";import"./_createCompounder-Db7SjIIq.js";function re(){const{sendMessage:r}=n.useContext(E),m=c(e=>e.devices),f=c(e=>e.deviceStates),t=c(e=>e.bridgeInfo.config),g=c(e=>e.availability),[o,D]=n.useState(w.get(j,!1)),[d,S]=n.useState(!1),{t:s}=q(["zigbee","common","availability"]),b=n.useMemo(()=>{const e=[];for(const i of m)if(i.type!=="Coordinator"&&(!o||!i.disabled)){const l=f[i.friendly_name]??{},p=t.devices[i.ieee_address]?.availability;if(d){if(i.power_source!=="Battery")continue;if("battery"in l){if(l.battery>=20)continue}else if("battery_state"in l){if(l.battery_state!=="low")continue}else if("battery_low"in l){if(!l.battery_low)continue}else continue}e.push({device:i,state:l,availabilityState:g[i.friendly_name]??{state:"offline"},availabilityEnabledForDevice:p!=null?!!p:void 0})}return e},[m,f,t.devices,g,o,d]),u=n.useCallback(e=>{w.set(j,e.target.checked),D(e.target.checked)},[]),v=n.useCallback(e=>{S(e.target.checked)},[]),y=n.useCallback(async(e,i,l)=>{await r("bridge/request/device/rename",{from:e,to:i,homeassistant_rename:l,last:void 0})},[r]),h=n.useCallback(async e=>{await r("bridge/request/device/configure",{id:e})},[r]),x=n.useCallback(async(e,i,l)=>{await r("bridge/request/device/remove",{id:e,force:i,block:l})},[r]),_=n.useCallback(async e=>{await r("bridge/request/device/interview",{id:e})},[r]),N=n.useMemo(()=>[{id:"friendly_name",header:s("common:friendly_name"),accessorFn:({device:e})=>[e.friendly_name,e.description].join(" "),cell:({row:{original:{device:e,state:i}}})=>a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"avatar",children:a.jsx("div",{className:"h-11 w-11",style:{overflow:"visible"},children:a.jsx(A,{device:e,otaState:i.update?.state,disabled:e.disabled})})}),a.jsxs("div",{className:"flex-grow flex flex-col",children:[a.jsx(C,{to:`/device/${e.ieee_address}/info`,className:"link link-hover",children:e.friendly_name}),e.description&&a.jsx("div",{className:"max-w-3xs text-xs opacity-50 truncate",title:e.description,children:e.description}),a.jsx("div",{className:"flex flex-row gap-1 mt-0.5 items-center",children:a.jsx("span",{className:"badge badge-soft badge-sm badge-ghost cursor-default",title:s("power"),children:a.jsx(R,{device:e,batteryPercent:i.battery,batteryState:i.battery_state,batteryLow:i.battery_low,showLevel:!0})})})]})]}),filterFn:"includesString"},{id:"ieee_address",header:s("ieee_address"),accessorFn:({device:e})=>[e.ieee_address,k(e.network_address,4),e.network_address].join(" "),cell:({row:{original:{device:e}}})=>a.jsxs(a.Fragment,{children:[a.jsx("div",{children:a.jsx(C,{to:`/device/${e.ieee_address}/info`,className:"link link-hover",children:e.ieee_address})}),a.jsxs("div",{className:"flex flex-row gap-1",children:[a.jsx("span",{className:"badge badge-ghost badge-sm cursor-default",title:s("network_address_hex"),children:k(e.network_address,4)}),a.jsx("span",{className:"badge badge-ghost badge-sm cursor-default",title:s("network_address_dec"),children:e.network_address})]})]}),filterFn:"includesString",sortingFn:(e,i)=>e.original.device.ieee_address.localeCompare(i.original.device.ieee_address)},{id:"model",header:s("model"),accessorFn:({device:e})=>[e.definition?.model,e.model_id,e.definition?.vendor,e.manufacturer].join(" "),cell:({row:{original:{device:e}}})=>a.jsxs(a.Fragment,{children:[a.jsx(V,{device:e}),a.jsx("div",{className:"flex flex-row gap-1",children:a.jsx("span",{className:"badge badge-ghost badge-sm",title:s("manufacturer"),children:a.jsx(B,{device:e})})})]}),filterFn:"includesString"},{id:"type",header:s("type"),accessorFn:({device:e})=>s(e.type),cell:({row:{original:{device:e}}})=>s(e.type),enableColumnFilter:!1},{id:"lqi",header:s("lqi"),accessorFn:({state:e})=>e.linkquality,cell:({row:{original:{state:e}}})=>a.jsx(O,{value:e.linkquality}),enableColumnFilter:!1},{id:"last_seen",header:s("last_seen"),accessorFn:({state:e})=>M(e.last_seen,t.advanced.last_seen)?.getTime(),cell:({row:{original:{state:e}}})=>a.jsx(P,{lastSeen:e.last_seen,config:t.advanced.last_seen}),enableColumnFilter:!1},{id:"availability",header:s("availability:availability"),accessorFn:({availabilityState:e})=>e.state,cell:({row:{original:{device:e,availabilityState:i,availabilityEnabledForDevice:l}}})=>a.jsx(I,{disabled:e.disabled,availability:i,availabilityEnabledForDevice:l,availabilityFeatureEnabled:t.availability.enabled}),enableColumnFilter:!1,sortingFn:(e,i)=>e.original.device.disabled||e.original.availabilityEnabledForDevice===!1?1:i.original.device.disabled||i.original.availabilityEnabledForDevice===!1?-1:e.original.availabilityState.state.localeCompare(i.original.availabilityState.state)},{id:"actions",header:()=>a.jsxs(a.Fragment,{children:[a.jsx(F,{name:"battery_low_only",detail:s("common:battery_low_only"),onChange:v,checked:d,className:"checkbox checkbox-sm"}),a.jsx(F,{name:"hide_disabled",detail:s("common:hide_disabled"),onChange:u,checked:o,className:"checkbox checkbox-sm"})]}),cell:({row:{original:{device:e,state:i}}})=>a.jsx(T,{device:e,state:i,homeassistantEnabled:t.homeassistant.enabled,renameDevice:y,removeDevice:x,configureDevice:h,interviewDevice:_}),enableSorting:!1,enableColumnFilter:!1}],[o,d,t.advanced.last_seen,t.availability.enabled,t.homeassistant.enabled,u,v,y,x,h,_,s]),L=n.useMemo(()=>({friendly_name:!0,ieee_address:!0,model:!0,type:!1,lqi:!0,last_seen:t.advanced.last_seen!=="disable",availability:t.availability.enabled||b.some(e=>e.availabilityEnabledForDevice),actions:!0}),[t.advanced.last_seen,t.availability.enabled,b]);return a.jsx(H,{id:"all-devices",columns:N,data:b,visibleColumns:L})}export{re as default};
